---
/**
 * SplitLayout.astro
 * 
 * Main container for the split-screen educational experience.
 * Left: Content panel with markdown content
 * Right: Animation panel with terminal-style visuals
 */

import type { SectionData } from '../lib/sections';
import WelcomeScreen from './WelcomeScreen.astro';
import IntroAnimation from './animations/01-IntroAnimation.astro';
import InterfacesAnimation from './animations/02-InterfacesAnimation.astro';
import RawTerminalAnimation from './animations/03-RawTerminalAnimation.astro';
import TranslatorAnimation from './animations/04-TranslatorAnimation.astro';
import PackageManagerAnimation from './animations/05-PackageManagerAnimation.astro';
import CreationAnimation from './animations/06-CreationAnimation.astro';
import MarkdownAnimation from './animations/07-MarkdownAnimation.astro';
import StructureAnimation from './animations/08-StructureAnimation.astro';
import ContextAnimation from './animations/09-ContextAnimation.astro';
import DecoratorsAnimation from './animations/10-DecoratorsAnimation.astro';
import FactoryAnimation from './animations/11-FactoryAnimation.astro';

interface Props {
  sections: SectionData[];
  initialSection?: number;
}

const { sections, initialSection = 1 } = Astro.props;

// Get initial section data
const currentSection = sections[initialSection - 1] || sections[0];
---

<!-- Welcome Screen (shown when no hash) -->
<WelcomeScreen />

<div 
  class="split-layout" 
  data-split-layout
  data-current-section={initialSection}
  data-total-sections={sections.length}
>
  <!-- Section Navigation Header -->
  <header class="split-header">
    <nav class="section-nav" aria-label="Section navigation">
      <button 
        class="nav-btn prev" 
        aria-label="Go to previous section"
        disabled={initialSection === 1}
      >
        <span class="nav-arrow">&larr;</span>
        <span class="nav-text">Previous</span>
      </button>
      
      <button 
        class="nav-btn next" 
        aria-label="Go to next section"
        disabled={initialSection === sections.length}
      >
        <span class="nav-text">Next</span>
        <span class="nav-arrow">&rarr;</span>
      </button>
    </nav>
  </header>

  <!-- Main Split Panels -->
  <main class="split-panels">
    <!-- Content Panel (Left) -->
    <aside class="content-panel" aria-label="Section content" data-content-panel>
      <div class="section-header">
        <div class="section-meta">
          <span class="section-number" data-section-number>{currentSection.number} of {sections.length}</span>
        </div>
        <h2 class="section-title" data-panel-title>{currentSection.title}</h2>
      </div>
      <div class="section-content">
        <article class="prose" data-prose set:html={currentSection.content} />
      </div>
    </aside>

    <!-- Animation Panel (Right) -->
    <div class="animation-panel" aria-label="Visual demonstration">
      <!-- Default placeholder (shown when no animation) -->
      <div class="default-terminal" data-default-animation>
        <div class="terminal-frame">
          <div class="terminal-header">
            <div class="window-controls">
              <span class="control red" aria-hidden="true"></span>
              <span class="control yellow" aria-hidden="true"></span>
              <span class="control green" aria-hidden="true"></span>
            </div>
            <span class="terminal-title" data-terminal-title>section-{currentSection.number}</span>
          </div>
          <div class="terminal-body">
            <div class="animation-placeholder" data-animation-content>
              <p class="prompt">$ getting-started</p>
              <p class="output">Loading section <span data-terminal-section-num>{currentSection.number}</span>...</p>
              <p class="highlight">"<span data-terminal-section-title>{currentSection.title}</span>"</p>
              <br />
              <p class="comment" data-animation-status># {currentSection.hasAnimation ? 'Animation ready' : 'No animation for this section'}</p>
              <span class="cursor"></span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Section 1: Intro Animation -->
      <div class="animation-container" data-animation-id="intro" style="display: none;">
        <IntroAnimation />
      </div>
      
      <!-- Section 2: Interfaces Animation -->
      <div class="animation-container" data-animation-id="interfaces" style="display: none;">
        <InterfacesAnimation />
      </div>
      
      <!-- Section 3: Raw Terminal Animation -->
      <div class="animation-container" data-animation-id="terminal-raw" style="display: none;">
        <RawTerminalAnimation />
      </div>
      
      <!-- Section 4: Translator Animation -->
      <div class="animation-container" data-animation-id="terminal-translator" style="display: none;">
        <TranslatorAnimation />
      </div>
      
      <!-- Section 5: Package Manager Animation -->
      <div class="animation-container" data-animation-id="packages" style="display: none;">
        <PackageManagerAnimation />
      </div>
      
      <!-- Section 6: Creation Animation -->
      <div class="animation-container" data-animation-id="creation" style="display: none;">
        <CreationAnimation />
      </div>
      
      <!-- Section 7: Markdown Animation -->
      <div class="animation-container" data-animation-id="markdown" style="display: none;">
        <MarkdownAnimation />
      </div>
      
      <!-- Section 8: Structure Animation -->
      <div class="animation-container" data-animation-id="structure" style="display: none;">
        <StructureAnimation />
      </div>
      
      <!-- Section 9: Context Animation -->
      <div class="animation-container" data-animation-id="context" style="display: none;">
        <ContextAnimation />
      </div>
      
      <!-- Section 10: Decorators Animation -->
      <div class="animation-container" data-animation-id="decorators" style="display: none;">
        <DecoratorsAnimation />
      </div>
      
      <!-- Section 11: Factory Animation -->
      <div class="animation-container" data-animation-id="factory" style="display: none;">
        <FactoryAnimation />
      </div>
    </div>
  </main>

  <!-- Section Footer with Progress -->
  <footer class="split-footer">
    <div class="progress-bar">
      <div 
        class="progress-fill" 
        style={`width: ${(initialSection / sections.length) * 100}%`}
        role="progressbar"
        aria-valuenow={initialSection}
        aria-valuemin={1}
        aria-valuemax={sections.length}
      ></div>
    </div>
    <div class="footer-info">
      <span class="keyboard-hint">Use arrow keys to navigate</span>
      <span class="section-count">{initialSection} / {sections.length}</span>
    </div>
  </footer>
</div>

<!-- Hidden data for JavaScript - includes full content for dynamic updates -->
<script define:vars={{ sections: sections.map(s => ({ id: s.id, number: s.number, title: s.title, content: s.content, hasAnimation: s.hasAnimation, animationComponent: s.animationComponent })) }}>
  window.__SECTIONS__ = sections;
</script>

<style>
  /* Full-screen immersive layout */
  .split-layout {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    background: #0a0a0f;
    opacity: 1;
    transition: opacity 0.3s ease-out;
  }

  /* Hidden state when welcome screen is active */
  .split-layout.hidden {
    opacity: 0;
    pointer-events: none;
  }
  
  /* Minimal header - unobtrusive */
  .split-header {
    background: rgba(10, 10, 15, 0.95);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    position: relative;
    z-index: 100;
    flex-shrink: 0;
  }
  
  .section-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 1.5rem;
    width: 100%;
  }
  
  .nav-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    font-family: 'Lora', Georgia, serif;
    font-size: 0.8rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.5);
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .nav-btn:hover:not(:disabled) {
    color: rgba(255, 255, 255, 0.9);
    border-color: rgba(255, 255, 255, 0.25);
    background: rgba(255, 255, 255, 0.05);
  }
  
  .nav-btn:disabled {
    opacity: 0.25;
    cursor: not-allowed;
  }
  
  .nav-arrow {
    font-size: 1rem;
  }
  
  .nav-info {
    text-align: center;
    flex: 1;
    min-width: 0;
  }
  
  .nav-current {
    font-family: 'Playfair Display', serif;
    font-weight: 500;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.85);
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  /* Main Panels - Full viewport */
  .split-panels {
    display: grid;
    grid-template-columns: 45% 55%;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }
  
  /* Animation panel - larger, focal point */
  .animation-panel {
    background: linear-gradient(135deg, #0d0d12 0%, #1a1a2e 100%);
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }
  
  /* Subtle glow effect on animation panel */
  .animation-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(ellipse at 50% 50%, rgba(59, 130, 246, 0.03) 0%, transparent 70%);
    pointer-events: none;
  }
  
  .animation-placeholder {
    font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', 'Consolas', monospace;
    position: relative;
    z-index: 1;
  }
  
  /* Footer - minimal, just progress */
  .split-footer {
    background: rgba(10, 10, 15, 0.95);
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255, 255, 255, 0.06);
    flex-shrink: 0;
  }
  
  .progress-bar {
    height: 2px;
    background: rgba(255, 255, 255, 0.05);
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6);
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .footer-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.4rem 1.5rem;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.35);
  }
  
  .keyboard-hint {
    font-family: 'Lora', Georgia, serif;
    opacity: 0.7;
  }
  
  .section-count {
    font-family: 'JetBrains Mono', monospace;
  }
  
  /* Responsive - tablet */
  @media (max-width: 1024px) {
    .split-panels {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr 1fr;
    }
    
    .nav-text {
      display: none;
    }
    
    .nav-btn {
      padding: 0.5rem 0.75rem;
    }
  }
  
  /* Responsive - mobile */
  @media (max-width: 640px) {
    .section-nav {
      padding: 0.4rem 1rem;
    }
    
    .nav-current {
      font-size: 0.8rem;
    }
    
    .footer-info {
      padding: 0.3rem 1rem;
    }
  }
  
  /* Ultra-wide screens - constrain slightly for readability */
  @media (min-width: 2000px) {
    .split-panels {
      grid-template-columns: 40% 60%;
    }
  }
  
  /* ===== Content Panel Styles ===== */
  .content-panel {
    background: linear-gradient(180deg, #0f0f14 0%, #0a0a0f 100%);
    border-right: 1px solid rgba(255, 255, 255, 0.06);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }
  
  .section-header {
    position: sticky;
    top: 0;
    background: rgba(15, 15, 20, 0.95);
    backdrop-filter: blur(8px);
    padding: 1.5rem 2rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    z-index: 10;
  }
  
  .section-meta {
    margin-bottom: 0.4rem;
  }
  
  .section-number {
    font-size: 0.7rem;
    font-weight: 600;
    color: rgba(139, 92, 246, 0.8);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }
  
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
    line-height: 1.3;
  }
  
  .section-content {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem 2rem 2rem;
  }
  
  /* Prose styling */
  .prose {
    font-family: 'Lora', Georgia, serif;
    font-size: 1rem;
    line-height: 1.85;
    color: rgba(255, 255, 255, 0.75);
    font-weight: 400;
  }
  
  .prose :global(h2) {
    font-family: 'Playfair Display', serif;
    font-size: 1.25rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    margin: 2rem 0 0.75rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }
  
  .prose :global(h2:first-child) {
    margin-top: 0;
    padding-top: 0;
    border-top: none;
  }
  
  .prose :global(h3) {
    font-size: 1rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.85);
    margin: 1.5rem 0 0.5rem;
  }
  
  .prose :global(p) {
    margin: 0.875rem 0;
  }
  
  .prose :global(p:first-child) {
    margin-top: 0;
  }
  
  .prose :global(strong) {
    color: rgba(255, 255, 255, 0.95);
    font-weight: 600;
  }
  
  .prose :global(em) {
    font-style: italic;
    color: rgba(255, 255, 255, 0.8);
  }
  
  .prose :global(a) {
    color: #60a5fa;
    text-decoration: none;
    border-bottom: 1px solid rgba(96, 165, 250, 0.3);
    transition: all 0.15s ease;
  }
  
  .prose :global(a:hover) {
    color: #93c5fd;
    border-bottom-color: rgba(147, 197, 253, 0.6);
  }
  
  .prose :global(ul),
  .prose :global(ol) {
    margin: 0.875rem 0;
    padding-left: 1.25rem;
  }
  
  .prose :global(li) {
    margin: 0.4rem 0;
  }
  
  .prose :global(li::marker) {
    color: rgba(139, 92, 246, 0.6);
  }
  
  .prose :global(blockquote) {
    border-left: 2px solid rgba(139, 92, 246, 0.5);
    padding-left: 1rem;
    margin: 1.25rem 0;
    font-style: italic;
    color: rgba(255, 255, 255, 0.6);
    background: rgba(139, 92, 246, 0.05);
    padding: 0.75rem 1rem;
    border-radius: 0 6px 6px 0;
  }
  
  .prose :global(code) {
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
    font-size: 0.85em;
    background: rgba(255, 255, 255, 0.08);
    color: #f472b6;
    padding: 0.15em 0.4em;
    border-radius: 4px;
  }
  
  .prose :global(pre) {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.06);
    color: #e5e7eb;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.25rem 0;
    font-size: 0.8rem;
    line-height: 1.6;
  }
  
  .prose :global(pre code) {
    background: none;
    padding: 0;
    font-size: inherit;
    color: inherit;
  }
  
  /* Content panel scrollbar */
  .section-content::-webkit-scrollbar {
    width: 6px;
  }
  
  .section-content::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .section-content::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 3px;
  }
  
  .section-content::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.25);
  }
  
  /* ===== Default Terminal (only for sections without animations) ===== */
  .default-terminal {
    height: 100%;
    width: 100%;
  }
  
  .default-terminal .terminal-frame {
    background: #0d0d0d;
    border-radius: 8px;
    overflow: hidden;
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
    height: 100%;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 1;
  }
  
  .default-terminal .terminal-header {
    background: #2d2d2d;
    padding: 10px 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid #1a1a1a;
  }
  
  .default-terminal .window-controls {
    display: flex;
    gap: 8px;
  }
  
  .default-terminal .control {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }
  
  .default-terminal .control.red { background: #ff5f56; }
  .default-terminal .control.yellow { background: #ffbd2e; }
  .default-terminal .control.green { background: #27ca40; }
  
  .default-terminal .terminal-title {
    color: #888;
    font-size: 0.8rem;
    user-select: none;
  }
  
  .default-terminal .terminal-body {
    flex: 1;
    padding: 1rem 1.25rem;
    color: #00ff00;
    font-size: 0.9rem;
    line-height: 1.6;
    overflow-y: auto;
    background: linear-gradient(180deg, #0d0d0d 0%, #111111 100%);
  }
  
  .default-terminal .terminal-body .prompt { color: #00ff00; }
  .default-terminal .terminal-body .output { color: #ccc; }
  .default-terminal .terminal-body .highlight { color: #00bfff; }
  .default-terminal .terminal-body .comment { color: #666; }
  .default-terminal .terminal-body .success { color: #27ca40; }
  .default-terminal .terminal-body .error { color: #ff5f56; }
  
  .default-terminal .terminal-body .cursor {
    display: inline-block;
    width: 8px;
    height: 1.1em;
    background: #00ff00;
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
  }
  
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  
  /* Animation containers - fill the panel completely */
  .animation-container {
    height: 100%;
    width: 100%;
    position: relative;
  }
  
  .animation-container[style*="display: none"] {
    display: none !important;
  }
  
  /* Responsive content panel */
  @media (max-width: 1024px) {
    .section-header {
      padding: 1rem 1.25rem 0.75rem;
    }
    
    .section-title {
      font-size: 1.25rem;
    }
    
    .section-content {
      padding: 1rem 1.25rem 1.5rem;
    }
  }
  
  @media (min-width: 1400px) {
    .section-content {
      padding: 2rem 2.5rem 2.5rem;
    }
  }
  
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .terminal-body .cursor {
      animation: none;
      opacity: 1;
    }
  }
</style>

<script>
  // Welcome state management
  function isWelcomeState(): boolean {
    return !window.location.hash;
  }

  function updateLayoutVisibility() {
    const layout = document.querySelector('[data-split-layout]') as HTMLElement;
    if (!layout) return;

    if (isWelcomeState()) {
      layout.classList.add('hidden');
    } else {
      layout.classList.remove('hidden');
    }
  }

  // Initialize layout visibility on load
  updateLayoutVisibility();

  // Listen for hash changes to toggle layout visibility
  window.addEventListener('hashchange', () => {
    updateLayoutVisibility();
  });

  // Section navigation logic with dynamic content updates
  const layout = document.querySelector('.split-layout') as HTMLElement;
  const prevBtn = document.querySelector('.nav-btn.prev') as HTMLButtonElement;
  const nextBtn = document.querySelector('.nav-btn.next') as HTMLButtonElement;
  const navTitleEl = document.querySelector('[data-section-title]') as HTMLElement;
  const progressFill = document.querySelector('.progress-fill') as HTMLElement;
  const sectionCountEl = document.querySelector('.section-count') as HTMLElement;
  
  // Content panel elements
  const panelTitleEl = document.querySelector('[data-panel-title]') as HTMLElement;
  const sectionNumberEl = document.querySelector('[data-section-number]') as HTMLElement;
  const proseEl = document.querySelector('[data-prose]') as HTMLElement;
  const sectionContentEl = document.querySelector('.section-content') as HTMLElement;
  
  // Terminal elements
  const terminalTitleEl = document.querySelector('[data-terminal-title]') as HTMLElement;
  const terminalSectionNumEl = document.querySelector('[data-terminal-section-num]') as HTMLElement;
  const terminalSectionTitleEl = document.querySelector('[data-terminal-section-title]') as HTMLElement;
  const animationStatusEl = document.querySelector('[data-animation-status]') as HTMLElement;
  
  // Animation elements
  const defaultAnimation = document.querySelector('[data-default-animation]') as HTMLElement;
  const animationContainers = document.querySelectorAll('[data-animation-id]') as NodeListOf<HTMLElement>;
  
  // Map section IDs to animation IDs
  const sectionAnimationMap: Record<string, string> = {
    'intro': 'intro',
    'interfaces': 'interfaces',
    'terminal-raw': 'terminal-raw',
    'terminal-translator': 'terminal-translator',
    'packages': 'packages',
    'creation': 'creation',
    'markdown': 'markdown',
    'structure': 'structure',
    'context': 'context',
    'decorators': 'decorators',
    'factory': 'factory',
  };
  
  // Type for section data (now includes content)
  interface SectionData {
    id: string;
    number: number;
    title: string;
    content: string;
    hasAnimation: boolean;
    animationComponent: string | null;
  }
  
  // Get sections data from window
  const sections: SectionData[] = (window as any).__SECTIONS__ || [];
  
  let currentSection = parseInt(layout?.dataset.currentSection || '1', 10);
  const totalSections = parseInt(layout?.dataset.totalSections || '1', 10);
  
  function showAnimationForSection(sectionId: string) {
    const animationId = sectionAnimationMap[sectionId];
    
    // Hide all animation containers first
    animationContainers.forEach(container => {
      container.style.display = 'none';
    });
    
    if (animationId) {
      // Show the specific animation, hide default
      const animationContainer = document.querySelector(`[data-animation-id="${animationId}"]`) as HTMLElement;
      if (animationContainer) {
        animationContainer.style.display = 'block';
        if (defaultAnimation) defaultAnimation.style.display = 'none';
      }
    } else {
      // Show default placeholder
      if (defaultAnimation) defaultAnimation.style.display = 'block';
    }
  }
  
  function updateUI() {
    const section = sections[currentSection - 1];
    if (!section) return;
    
    // Update nav header title
    if (navTitleEl) navTitleEl.textContent = section.title;
    
    // Update content panel
    if (panelTitleEl) panelTitleEl.textContent = section.title;
    if (sectionNumberEl) sectionNumberEl.textContent = `${section.number} of ${totalSections}`;
    if (proseEl) proseEl.innerHTML = section.content;
    
    // Scroll content to top
    if (sectionContentEl) sectionContentEl.scrollTop = 0;
    
    // Update terminal
    if (terminalTitleEl) terminalTitleEl.textContent = `section-${section.number}`;
    if (terminalSectionNumEl) terminalSectionNumEl.textContent = String(section.number);
    if (terminalSectionTitleEl) terminalSectionTitleEl.textContent = section.title;
    if (animationStatusEl) {
      animationStatusEl.textContent = section.hasAnimation 
        ? '# Animation ready' 
        : '# No animation for this section';
    }
    
    // Show/hide animations based on section
    showAnimationForSection(section.id);
    
    // Update buttons
    if (prevBtn) prevBtn.disabled = currentSection === 1;
    if (nextBtn) nextBtn.disabled = currentSection === totalSections;
    
    // Update progress
    const progress = (currentSection / totalSections) * 100;
    if (progressFill) progressFill.style.width = `${progress}%`;
    if (sectionCountEl) sectionCountEl.textContent = `${currentSection} / ${totalSections}`;
    
    // Update URL hash
    if (section.id) {
      history.replaceState(null, '', `#${section.id}`);
    }
    
    // Dispatch event for other components (animations, etc.)
    document.dispatchEvent(new CustomEvent('section:change', { 
      detail: { section: currentSection, sectionData: section } 
    }));
  }
  
  function goToSection(num: number) {
    if (num < 1 || num > totalSections) return;
    currentSection = num;
    layout.dataset.currentSection = String(num);
    updateUI();
  }
  
  function goToPrev() {
    goToSection(currentSection - 1);
  }
  
  function goToNext() {
    goToSection(currentSection + 1);
  }
  
  // Button click handlers
  prevBtn?.addEventListener('click', goToPrev);
  nextBtn?.addEventListener('click', goToNext);
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    // Ignore if user is typing in an input
    if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {
      return;
    }
    
    switch (e.key) {
      case 'ArrowLeft':
      case 'ArrowUp':
        e.preventDefault();
        goToPrev();
        break;
      case 'ArrowRight':
      case 'ArrowDown':
        e.preventDefault();
        goToNext();
        break;
    }
  });
  
  // Initialize from URL hash
  function initFromHash() {
    const hash = window.location.hash.slice(1);
    if (hash) {
      const sectionIndex = sections.findIndex(s => s.id === hash);
      if (sectionIndex >= 0) {
        goToSection(sectionIndex + 1);
      }
    }
  }
  
  // Handle hash changes
  window.addEventListener('hashchange', initFromHash);
  
  // Initialize
  initFromHash();
</script>
